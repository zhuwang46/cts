<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>cts: An R Package for Continuous Time Autoregressive Models via Kalman Filter • cts</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="cts: An R Package for Continuous Time Autoregressive Models via Kalman Filter">
<meta property="og:description" content="cts">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cts</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0-23</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/kf.html">cts: An R Package for Continuous Time Autoregressive Models via Kalman Filter</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="kf_files/jquery-1.11.3/jquery.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1">
<link href="kf_files/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet">
<script src="kf_files/bootstrap-3.3.5/js/bootstrap.min.js"></script><script src="kf_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script><script src="kf_files/bootstrap-3.3.5/shim/respond.min.js"></script><script src="kf_files/navigation-1.1/tabsets.js"></script><link href="kf_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="kf_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>cts: An R Package for Continuous Time Autoregressive Models via Kalman Filter</h1>
                        <h4 class="author">Zhu Wang<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a>
</h4>
            
            <h4 class="date">November 24, 2020</h4>
      
      
      <div class="hidden name"><code>kf.Rmd</code></div>

    </div>

    
        <div class="abstract">
      <p class="abstract">Abstract</p>
      We describe an <em>R</em> package <em>cts</em> for fitting a modified form of continuous time autoregressive model, which can be particularly useful with unequally sampled time series. The estimation is based on the application of the Kalman filter. The paper provides the methods and algorithms implemented in the package, including parameter estimation, spectral analysis, forecasting, model checking and Kalman smoothing. The package contains <em>R</em> functions which interface underlying Fortran routines. The package is applied to geophysical and medical data for illustration.
    </div>
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a><span class="header-section-number">0.1</span> Introduction</h2>
<p>The discrete time autoregressive model of order <span class="math inline">\(p\)</span>, the AR<span class="math inline">\((p)\)</span>, is a widely used tool for modeling equally spaced time series data. It can be fitted in a straightforward and reliable manner and has the capacity to approximate a second order stationary process to any required degree of precision by choice of a suitably high order. Various information criteria such as the AIC <span class="citation">(Akaike <a href="#ref-Akaike1974">1974</a>)</span> or the BIC <span class="citation">(Schwarz <a href="#ref-bic">1978</a>)</span> can, in practice be used to determine a suitable order when fitting to a finite data set. This model is clearly not appropriate for irregularly sampled data, for which various authors have advocated the use of the continuous time autoregressive model of order <span class="math inline">\(p\)</span>, the CAR<span class="math inline">\((p)\)</span>. For example <span class="citation">Jones (<a href="#ref-Jone:1981">1981</a>)</span> developed an estimation method for the CAR<span class="math inline">\((p)\)</span> fitted to discretely sampled data through the application of the Kalman filter. However, the CAR<span class="math inline">\((p)\)</span> model does not share with its discrete counterpart the same capacity to approximate any second order stationary continuous process. <span class="citation">Belcher, Hampton, and Tunnicliffe Wilson (<a href="#ref-Belc:Hamp:Tunn:1994">1994</a>)</span> modified the parameterization and structure of the CAR<span class="math inline">\((p)\)</span> model in such a way that this general capacity for approximation was restored, requiring only a relatively minor modification of the estimation procedure of Jones. More recently, see <span class="citation">Tunnicliffe Wilson and Morton (<a href="#ref-Tunn:2004">2004</a>)</span>, this modified CAR<span class="math inline">\((p)\)</span> model has been named the CZAR<span class="math inline">\((p)\)</span> model and expressed in autoregressive form using the generalized continuous time shift operator with the alternative parameterization appearing in a natural manner. <span class="citation">Wang, Woodward, and Gray (<a href="#ref-Wang:Wood:Gray:2008">2009</a>)</span> utilized the methods in <span class="citation">Belcher, Hampton, and Tunnicliffe Wilson (<a href="#ref-Belc:Hamp:Tunn:1994">1994</a>)</span> for fitting time varying nonstationary models. The CAR models have seen practical usages in many fields including astronomics, medicine and economics. See <span class="citation">Whitelock et al. (<a href="#ref-Whit:2004">2004</a>)</span>, <span class="citation">Belcher, Hampton, and Tunnicliffe Wilson (<a href="#ref-Belc:Hamp:Tunn:1994">1994</a>)</span>, <span class="citation">Bergstrom (<a href="#ref-Berg:1990">1990</a>)</span>.</p>
<p>Since the technical details for the Kalman filter on CAR models are scattered in the literature, we give a thorough presentation in this paper, which provides a foundation for the implementations in the <em>R</em> <span class="citation">( Development Core Team <a href="#ref-Rcite">2020</a>)</span> package <em>cts</em> <span class="citation">(Tunnicliffe Wilson and Wang <a href="#ref-cts">2013</a>)</span> for fitting CAR models with discrete data. The <em>cts</em> package contains typical time series applications including spectral estimation, forecasting, diagnostics, smoothing and signal extraction. The application is focused on unequally spaced data although the techniques can be applied to equally spaced data as well. The paper is organized as follows. Section Methods summarizes the methods from which the <em>cts</em> package was developed. Section Implementation outlines the implementations in the package. Section Data examples illustrates the capabilities of <em>cts</em> with two data sets. Finally, Section Conclusion concludes the paper.</p>
</div>
<div id="methods" class="section level2">
<h2 class="hasAnchor">
<a href="#methods" class="anchor"></a><span class="header-section-number">0.2</span> Methods</h2>
<div id="the-car-and-czar-model" class="section level3">
<h3 class="hasAnchor">
<a href="#the-car-and-czar-model" class="anchor"></a><span class="header-section-number">0.2.1</span> The CAR and CZAR model</h3>
Suppose we have data <span class="math inline">\(x_{k}\)</span> observed on time <span class="math inline">\(t_{k}\)</span> for <span class="math inline">\(k=1,2, ...,n\)</span>. We assume noise-affected observations <span class="math inline">\(x_{k}=y(t_{k})+\eta_{k}\)</span> and <span class="math inline">\(y(t_{k})\)</span> follows a <span class="math inline">\(p\)</span>-th order continuous time autoregressive process <span class="math inline">\(Y(t)\)</span> satisfying
<span class="math display" id="eq:ARp">\[\begin{equation}
  Y^{(p)}(t)+\alpha_1Y^{(p-1)}(t)+\ldots+\alpha_{p-1}Y^{(1)}(t)+\alpha_pY(t)=\epsilon(t)
  \tag{1}
\end{equation}\]</span>
<p>where <span class="math inline">\(Y^{(i)}(t)\)</span> is the <span class="math inline">\(i\)</span>th derivative of <span class="math inline">\(Y(t)\)</span> and <span class="math inline">\(\epsilon(t)\)</span> is the formal derivative of a Brownian process <span class="math inline">\(B(t)\)</span> with variance parameter <span class="math inline">\(\sigma^2 = \textrm{var}\{B(t +1) - B(t)\}\)</span>. In addition, it will be assumed that <span class="math inline">\(\eta_{k}\)</span> is a normally distributed random variable representing observational error, uncorrelated with <span class="math inline">\(\epsilon(t)\)</span>, and <span class="math inline">\(E(\eta_k) =0; E(\eta_j \eta_k) =0, \mbox{for } j\neq k; E(\eta_k^2) =\gamma\sigma^2.\)</span></p>
The operator notation of model <a href="#eq:ARp">(1)</a> is <span class="math inline">\(\alpha(D)Y(t)=\epsilon(t)\)</span> where
<span class="math display">\[\begin{equation}
\alpha(D)=D^p+\alpha_1 D^{p-1}+...+\alpha_{p-1} D+\alpha_{p},
\end{equation}\]</span>
where <span class="math inline">\(D\)</span> is the derivative operator. The corresponding characteristic equation is then given by
<span class="math display">\[\begin{equation}
\alpha(s)=s^p+\alpha_1 s^{p-1}+...+\alpha_{p-1} s+\alpha_{s}=0.
\end{equation}\]</span>
To assure the stability of the model, a parameterization was constructed on the zeros <span class="math inline">\(r_1,...,r_p\)</span> of <span class="math inline">\(\alpha(s)\)</span> <span class="citation">(Jones <a href="#ref-Jone:1981">1981</a>)</span>, i.e.,
<span class="math display" id="eq:carfac">\[\begin{equation}
\alpha(s)=\prod_{i=1}^{p}(s-r_i).
\tag{2}
\end{equation}\]</span>
The model in the <em>cts</em> package follows the modified structure <span class="citation">(Belcher, Hampton, and Tunnicliffe Wilson <a href="#ref-Belc:Hamp:Tunn:1994">1994</a>)</span>:
<span class="math display" id="eq:belc1">\[\begin{equation}
\alpha(D)Y(t)=(1+D/\kappa)^{p-1}\epsilon(t),
\tag{3}
\end{equation}\]</span>
<p>with scaling parameter <span class="math inline">\(\kappa&gt;0\)</span>. This introduces a prescribed moving average operator of order <span class="math inline">\(p-1\)</span> into the model, which makes the model selection convenient along with other theoretic benefits described in <span class="citation">Belcher, Hampton, and Tunnicliffe Wilson (<a href="#ref-Belc:Hamp:Tunn:1994">1994</a>)</span>. In practice model <a href="#eq:belc1">(3)</a> has been found to fit data quite well without the need for an observation error term <span class="citation">(Belcher, Hampton, and Tunnicliffe Wilson <a href="#ref-Belc:Hamp:Tunn:1994">1994</a>)</span>. Indeed, for large orders <span class="math inline">\(p\)</span>, the observation error variance may become confounded with the parameters of model <a href="#eq:belc1">(3)</a>, thus leading to some difficulty in estimation <span class="citation">(Belcher, Hampton, and Tunnicliffe Wilson <a href="#ref-Belc:Hamp:Tunn:1994">1994</a>)</span>. As argued by these authors, model <a href="#eq:belc1">(3)</a> can be sufficient unless there is a substantial variability for measurements at the same or very nearly coincident times.</p>
The power spectrum of the <span class="math inline">\(p\)</span>th order continuous process <a href="#eq:belc1">(3)</a> is defined by
<span class="math display" id="eq:carspe">\[\begin{equation}
G_y(f)=2\pi\sigma^2\left|\frac{(1+\mbox{i}2\pi f/\kappa)^{p-1}}{\alpha(\mbox{i}2\pi f)}\right|^2.
\tag{4}
\end{equation}\]</span>
This may also be expressed in a form which defines the alternative set of parameters <span class="math inline">\(\phi_1, . . . , \phi_p\)</span>, by using a transformation <span class="math inline">\(g = \arctan(2\pi f/\kappa)/\pi\)</span> of the frequency <span class="math inline">\(f\)</span>:
<span class="math display">\[\begin{equation*}\label{E:carspe1}
G_y(f)=\frac{\sigma^2/\kappa^{2p-2}}{\kappa^2 + (2\pi f)^2} \left| \frac{\phi(-1)}{\phi\{\exp(2\pi i g)\}}\right|^2 2\pi,
\end{equation*}\]</span>
where
<span class="math display">\[\begin{equation*}
\phi(z) = 1+\phi_1z + ... + \phi_p z^p.
\end{equation*}\]</span>
<p>The link between the <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\phi\)</span> parameters is given in <span class="citation">Belcher, Hampton, and Tunnicliffe Wilson (<a href="#ref-Belc:Hamp:Tunn:1994">1994</a>)</span> (9) and the line which follows. The new parameter space is identical to that of the stationary discrete time autoregressive model. The CZAR model of Tunnicliffe Wilson and Morton is identical except that the right-hand side of <a href="#eq:belc1">(3)</a> is modified to <span class="math inline">\((\kappa+D)^{p-1}\epsilon(t)\)</span> so that <span class="math inline">\(\sigma^2/\kappa^{2p-2}\)</span> is re-scaled to <span class="math inline">\(\sigma^2\)</span>. The system frequencies are determined by the roots of <a href="#eq:carfac">(2)</a>. In fact, the representation of <a href="#eq:carfac">(2)</a> breaks a <span class="math inline">\(p\)</span>th order autoregressive operator into its irreducible linear and quadratic factors that have complex zeros. A quadratic factor <span class="math inline">\((s-r_{2k-1})(s-r_{2k})\)</span> with complex zeros is associated with a component of the data having the nature of a stochastic cycle, with approximate frequency given by <span class="math inline">\(f=\frac{|\Im(r_{2k})|}{2\pi}\)</span>, where <span class="math inline">\(|\Im(r_{2k})|\)</span> is the absolute value of the imaginary part of <span class="math inline">\(r_{2k}\)</span>. This will be reflected as a component of the autocorrelations with the same frequency, decaying in amplitude with a rate equal to the absolute value of the real part of the same zero. The model can represent a strong cycle in the data if this decay rate is very low. A linear factor with zero at <span class="math inline">\(r_k\)</span> is associated with a component of the data having the nature of a first order autoregression with autocorrelation function exponentially decaying at the rate <span class="math inline">\(r_k\)</span>. If <span class="math inline">\(r_k\)</span> is very large, this can give the appearance of a white noise component.</p>
</div>
<div id="sub:modest" class="section level3">
<h3 class="hasAnchor">
<a href="#sub:modest" class="anchor"></a><span class="header-section-number">0.2.2</span> Kalman filtering</h3>
This section deals with the details related to applying the Kalman filter to estimate the parameters of model <a href="#eq:belc1">(3)</a>, following <span class="citation">Jones (<a href="#ref-Jone:1981">1981</a>)</span> and <span class="citation">Belcher, Hampton, and Tunnicliffe Wilson (<a href="#ref-Belc:Hamp:Tunn:1994">1994</a>)</span>. To apply the Kalman filter, it is required to rewrite model <a href="#eq:belc1">(3)</a> to a state space form, which may be found in <span class="citation">Wiberg (<a href="#ref-Wibe:1971">1971</a>)</span>. Let the unobservable state vector <span class="math inline">\(\theta(t)=(z(t), z'(t), z''(t) ...,z^{(p-1)}(t))^\top\)</span> and <span class="math inline">\(\theta'\)</span> the first derivative of <span class="math inline">\(\theta(t)\)</span>. The state equation is then given by
<span class="math display" id="eq:carsta">\[\begin{equation}
\theta'=A\theta+R\epsilon,
\tag{5}
\end{equation}\]</span>
where
<span class="math display" id="eq:Amat">\[\begin{equation}
A= \begin{bmatrix}
0 &amp; 1 &amp; \ldots &amp; 0  \\
0 &amp; 0 &amp; \ldots &amp; 0  \\
\vdots \\
0 &amp; 0 &amp; \ldots &amp; 1 \\
-\alpha_p &amp; -\alpha_{p-1} &amp; \ldots &amp; -\alpha_1\\
\end{bmatrix}
\tag{6}
\end{equation}\]</span>
and
<span class="math display" id="eq:Rvec">\[\begin{equation}
R^\top=         \begin{bmatrix}
0 &amp; 0 &amp; ... &amp; 1\\
\end{bmatrix}.
\tag{7}
\end{equation}\]</span>
The observation equation is given by
<span class="math display" id="eq:carobs">\[\begin{equation}
x_{k}=H\theta(t_{k})+\eta_{k},
\tag{8}
\end{equation}\]</span>
where the elements of the <span class="math inline">\(1\times p\)</span> vector <span class="math inline">\(H\)</span> are given by
<span class="math display" id="eq:Hvec">\[\begin{equation}
H_i={p-1 \choose i-1} /\kappa^{i-1} \qquad i=1,...,p.
\tag{9}
\end{equation}\]</span>
Suppose that <span class="math inline">\(A\)</span> can be diagonalized by <span class="math inline">\(A=U\mathbf{D}U^{-1}\)</span>, where
<span class="math display" id="eq:Umat">\[\begin{equation}
U= \begin{bmatrix}
1 &amp; 1 &amp; \ldots &amp; 1  \\
r_1 &amp; r_2 &amp; \ldots &amp; r_p  \\
r^2_1 &amp; r^2_2 &amp; \ldots &amp; r^2_p \\
\vdots \\
r^{p-1}_1 &amp; r^{p-1}_2 &amp; \ldots &amp; r^{p-1}_p\\
\end{bmatrix},
\tag{10}
\end{equation}\]</span>
<span class="math inline">\(r_1, r_2, ..., r_p\)</span> are the roots of <span class="math inline">\(\alpha(s)\)</span>, and <span class="math inline">\(\mathbf{D}\)</span> is a diagonal matrix with these roots as its diagonal elements. In this case, we let <span class="math inline">\(\theta=U\psi\)</span>, and the state equation becomes
<span class="math display" id="eq:stadiag">\[\begin{equation}
\psi'=\mathbf{D}\psi+J\epsilon,
\tag{11}
\end{equation}\]</span>
where <span class="math inline">\(J=U^{-1}R\)</span>. Consequently, the observation equation becomes
<span class="math display">\[\begin{equation}
x_{k}=G\psi(t_{k})+\eta_{k}
\end{equation}\]</span>
<p>where <span class="math inline">\(G=HU\)</span>. The necessary and sufficient condition for the diagonalization of <span class="math inline">\(A\)</span> is that <span class="math inline">\(A\)</span> has distinct eigenvalues. The diagonal form not only provides computational efficiency, but also provides an interpretation of unobserved components. The evaluation of <span class="math inline">\(T_{\theta,k}=e^{A\delta_k}\)</span> (standard form) is required where <span class="math inline">\(\delta_k=t_k-t_{k-1}\)</span>. For a review of computations related to the exponential of a matrix, see <span class="citation">Moler and Loan (<a href="#ref-Mole:Loan:2003">2003</a>)</span>. For the diagonal form, <span class="math inline">\(T_{\psi,k}=e^{\mathbf{D}\delta_k}\)</span> is diagonal with elements <span class="math inline">\(e^{r_i\delta_k}\)</span>. When a diagonal form is not available, a numerical matrix exponential evaluation is needed.</p>
To start the Kalman filter recursions, initial conditions are in demand. For a stationary model, the unconditional covariance matrix of state vector <span class="math inline">\(\theta(t)\)</span> is known <span class="citation">(Doob <a href="#ref-Doob:1953">1953</a>)</span> and used in <span class="citation">Jones (<a href="#ref-Jone:1981">1981</a>)</span> and <span class="citation">Harvey (<a href="#ref-Harv:1990">1990</a>)</span> 9.1. The initial state for both standard and diagonalized version can be set as <span class="math inline">\(\theta_0=0\)</span> and <span class="math inline">\(\psi_0=0\)</span>, respectively. The stationary covariance matrix <span class="math inline">\(Q\)</span> satisfies
<span class="math display">\[\begin{equation}{E:Q}
Q=\sigma^2\int_{0}^{\infty}e^{As}RR^\top e^{A^\top s}ds.
\end{equation}\]</span>
When <span class="math inline">\(A\)</span> can be diagonalized, it is straightforward to show that
<span class="math display" id="eq:Qini">\[\begin{equation}
Q_{\psi_{i,j}}=-\sigma^2J_i \bar{J_j}/(r_i+\bar{r}_j),
\tag{12}
\end{equation}\]</span>
<p>where <span class="math inline">\(\bar{J_j}\)</span> and <span class="math inline">\(\bar{r}_j\)</span> are complex conjugates of <span class="math inline">\(J_j\)</span> and <span class="math inline">\(r_j\)</span>, respectively.</p>
The scale parameter <span class="math inline">\(\kappa\)</span> can be chosen approximately as the reciprocal of the mean time between observations. The algorithm of Kalman filter for the diagonal form is presented below. Starting with an initial stationary state vector of <span class="math inline">\(\psi_0=\psi(0|0)=0\)</span> and the initial stationary state covariance matrix <span class="math inline">\(Q_{\psi}\)</span> <a href="#eq:Qini">(12)</a>, the recursion proceeds as follows:

<p>When a diagonal form is not stable, a standard form Kalman filter recursion may be found in <span class="citation">Belcher, Hampton, and Tunnicliffe Wilson (<a href="#ref-Belc:Hamp:Tunn:1994">1994</a>)</span> or <span class="citation">Wang (<a href="#ref-Wang:2004">2004</a>)</span>. However, the computational load is reduced dramatically with the diagonal form since matrix <span class="math inline">\(\mathbf{D}\)</span> is diagonal.</p>
<p>When the nonlinear optimization is successfully completed, in addition to the maximum likelihood estimation of the parameters and error variances, the Kalman filter returns the optimal estimate of the state and the state covariance matrix at the last time point. The forecasting of the state, state covariance matrix and observation can be continued into future desired time points using equations from <a href="#eq:carkal1d">(<strong>??</strong>)</a> to <a href="#eq:carkal4d">(<strong>??</strong>)</a>.</p>
</div>
<div id="S:caraic" class="section level3">
<h3 class="hasAnchor">
<a href="#S:caraic" class="anchor"></a><span class="header-section-number">0.2.3</span> Model selection</h3>
<p>To identify a model order, <span class="citation">Belcher, Hampton, and Tunnicliffe Wilson (<a href="#ref-Belc:Hamp:Tunn:1994">1994</a>)</span> proposed a strategy corresponding to the reparameterization. Start with a large order model, and obtain the parameter vector <span class="math inline">\(\phi\)</span> and its covariance matrix <span class="math inline">\(V_\phi\)</span>, we then make a Cholesky decomposition such that <span class="math inline">\(V^{-1}_\phi=L_\phi L^\top_\phi\)</span> where <span class="math inline">\(L_\phi\)</span> is a lower triangular matrix, and define the vector <span class="math inline">\(t_\phi=L^\top_\phi \phi\)</span> and construct the sequence <span class="math inline">\(AIC_d=-\sum_{i=1}^{d}t^2_{\phi,i}+2d\)</span> for <span class="math inline">\(d=1,...,p\)</span>. The index of the minimum value of <span class="math inline">\(AIC_d\)</span> suggests a preferred model order. In addition, if the true model order <span class="math inline">\(p\)</span> is less than the large value used for model estimation, then for <span class="math inline">\(i&gt;p\)</span> the <span class="math inline">\(t\)</span>-statistics may be treated as normal-distributed variables, so that the deviation from their true values of 0 will be small. However, Belcher et al used a 33MHz maths co-processor, and with the speed of present day computers the best practice is to compute the classical AIC or BIC by fitting the models of increasing order <span class="math inline">\(p\)</span> to the series. The AIC is defined as <span class="math inline">\(n \log SS(p)+2p\)</span> and BIC is defined as <span class="math inline">\(n\log SS(p) + p \log(p)\)</span> where <span class="math inline">\(SS\)</span> is the sum of squares function given by <span class="citation">Belcher, Hampton, and Tunnicliffe Wilson (<a href="#ref-Belc:Hamp:Tunn:1994">1994</a>)</span> equation 15. The AIC and BIC can be easily modified if an additional mean value of the series is estimated. The package <em>cts</em> has implemented the relevant functions for model selection and a data example will be illustrated.</p>
</div>
<div id="S:cardiag" class="section level3">
<h3 class="hasAnchor">
<a href="#S:cardiag" class="anchor"></a><span class="header-section-number">0.2.4</span> Diagnostics</h3>
The assumptions underlying the model <a href="#eq:carsta">(5)</a> and <a href="#eq:carobs">(8)</a> are that the disturbances <span class="math inline">\(\epsilon(t)\)</span> and <span class="math inline">\(\eta_{k}\)</span> are normally distributed and serially independent with constant variances. Based on these assumptions, the standardized one-step forecast errors
<span class="math display">\[\begin{equation}
e(t_k)=v(t_k)/\sqrt{F(t_k)} \qquad k=1,...,n
\end{equation}\]</span>
<p>are also normally distributed and serially independent with unit variance. Hence, in addition to inspection of time plot, the QQ-normal plot can be used to visualize the ordered residuals against their theoretical quantiles. For a white noise sequence, the sample autocorrelations are approximately independently and normally distributed with zero means and variances <span class="math inline">\(1/n\)</span>. Note that for a purely random series, the cumulative periodogram should follow along a line <span class="math inline">\(y=2x\)</span> where <span class="math inline">\(x\)</span> is frequency. A standard portmanteau test statistic for serial correlation, such as the Ljung-Box statistic, can be used as well. The proposed calculation of the scaled innovation is frequently done in classical discrete-time models. This way a sequence of <span class="math inline">\(n\)</span> numbers is calculated, and the auto-correlation and discrete-time spectrum of these numbers are calculated, i.e. the time between observations does not enter these calculations.</p>
</div>
<div id="S:carsmo" class="section level3">
<h3 class="hasAnchor">
<a href="#S:carsmo" class="anchor"></a><span class="header-section-number">0.2.5</span> Kalman smoothing</h3>
For a structural time series model, it is often of interest to estimate the unobserved components at all points in the sample. Estimation of smoothed trend and cyclical components provides an example. The purpose of smoothing at time <span class="math inline">\(t\)</span> is to find the expected value of the state vector, conditional on the information made available after time <span class="math inline">\(t\)</span>. In this section, a fixed-interval smoothing algorithm <span class="citation">Harvey (<a href="#ref-Harv:1990">1990</a>)</span> 3.6.2 is implemented with modifications for the model considered, though a more efficient approach is possible, see the discussion in <span class="citation">Durbin and Koopman (<a href="#ref-Durb:Koop:2001">2001</a>)</span> 4.3. Estimating unobserved components relies on the diagonal form which provides the associated structure with the corresponding roots <span class="math inline">\(r_1, ... r_p\)</span>. The smoothing state and covariance matrix are given by
<span class="math display">\[\begin{equation}
\begin{aligned}
\psi_s(t_k|t_n)&amp;=\psi(t_k|t_k)+P^*(t_k)(\psi_s(t_{k+1}|t_n)%-\psi(t_{k+1}|t_k))
-\psi(t_{k+1}|t_k))\\
P_s(t_k|t_n)&amp;=P(t_k|t_k)+P^*(t_k)(P_s(t_{k+1}|t_n)%-P(t_{k+1}|t_k))\bar{P}^*(t_k)\\
-P(t_{k+1}|t_k))\bar{P}^*(t_k),
\end{aligned}
\end{equation}\]</span>
where
<span class="math display">\[\begin{equation}
P^*(t_k)=P(t_k|t_k)\bar{T}_{\psi,k+1}P^{-1}(t_{k+1}|t_k),
\end{equation}\]</span>
<p><span class="math inline">\({T}_{\psi,k+1}=e^{\mathbf{D}(t_{k+2}-t_{k+1})}\)</span>, and <span class="math inline">\(\bar{T}_{\psi,k+1}\)</span> and <span class="math inline">\(\bar{P}(t_k|t_k)\)</span> are complex conjugates. To start the recursion, the initial values are given by <span class="math inline">\(\psi_s(t_n|t_n)=\psi(t_n|t_n)\)</span> and <span class="math inline">\(P_s(t_n|t_n)=P(t_n|t_n)\)</span>. The observed value <span class="math inline">\(x_{k}\)</span>, in the absence of measurement error, is the sum of contributions from the diagonalized state variables <span class="math inline">\(\psi\)</span>, i.e., <span class="math inline">\(x_{k}=\sum_jG_j\psi_j(t_{k})\)</span>. Therefore, the original data may be partitioned, as in <span class="citation">Jenkins and Watts (<a href="#ref-Jenk:Watt:1968">1968</a>)</span> 7.3.5. Any pair of two complex conjugate zeros of <a href="#eq:carfac">(2)</a> is associated with two corresponding state variables whose combined contribution to <span class="math inline">\(x_{k}\)</span> represents a source of diurnal variation. The real zeros correspond to exponential decay. If a real zero is very large, this can provide an appearance of white noise component. Hence, the contributions <span class="math inline">\(G_j\psi_j\)</span> at every time point can be estimated from all the data using the Kalman smoother as described above.</p>
</div>
</div>
<div id="implementation" class="section level2">
<h2 class="hasAnchor">
<a href="#implementation" class="anchor"></a><span class="header-section-number">0.3</span> Implementation</h2>
<p>The <em>cts</em> package utilizes the Fortran program developed by the authors of <span class="citation">Belcher, Hampton, and Tunnicliffe Wilson (<a href="#ref-Belc:Hamp:Tunn:1994">1994</a>)</span>, with substantial additional Fortran and <em>R</em> routines. In this process, two Fortran subroutines in <span class="citation">Belcher, Hampton, and Tunnicliffe Wilson (<a href="#ref-Belc:Hamp:Tunn:1994">1994</a>)</span> have to be substituted since they belong to commercial NAG Fortran Library, developed by the Numerical Algorithms Group. One subroutine was to compute the approximate solution of a set of complex linear equations with multiple right-hand sides, using an Lower-Upper <em>LU</em> factorization with partial pivoting. Another subroutine was to find all roots of a real polynomial equation, using a variant of Laguerre's Method. In the <em>cts</em> package, these subroutines have been replaced by their public available counterparts in the LAPACK &amp; BLAS Fortran Library. All the Fortran programs were written in double precision.</p>
<p>If a constant term is estimated by the default setting <em>ccv="CTES"</em> in the <em>car</em> function, it represents the mean <span class="math inline">\(\mu\)</span>, and the model is formulated in terms of <span class="math inline">\((x-\mu)\)</span>. In the setting <em>ccv="MNCT"</em>, the series is not actually mean corrected, but the sample mean is just used to estimate <span class="math inline">\(\mu\)</span> in the above model formulation. Several supporting <em>R</em> functions are available in the <em>cts</em> package that extract or calculate useful statistics based on the fitted CAR model, such as model summary, predicted values and model spectrum. In particular, the function <em>car</em> returns objects of class <em>car</em>, for which the following methods are available: <em>print, summary, plot, predict, AIC, tsdiag, spectrum, kalsmo</em>. A detailed description of these functions is available in the online help files. Here a brief introduction will be given and the usage will be illustrated in the next section. Specifying <em>trace=TRUE</em> in <em>car_control</em> could trigger annotated printout of information during the fitting process and major results for the fitted model. The model fitting results can be graphical displayed with <em>plot</em> function. With argument <em>type</em> equal to <em>"spec", "pred"</em> and <em>"diag"</em>, respectively, a figure can be plotted for spectrum, predicted values and model diagnostic checking, respectively. Three types of prediction exist: forecast past the end, forecast last L-step, forecast last L-step update. This can be achieved by invoking argument <em>fty=1, 2, 3</em>, respectively. For instance, <em>ctrl=car_control(fty=1, n.ahead=10)</em> can predict 10 steps past the end. Function <em>AIC</em> can generate both <span class="math inline">\(t\)</span>-statistic and AIC values following section <a href="#S:caraic">0.2.3</a>. Function <em>tsdiag</em> follows section <a href="#S:cardiag">0.2.4</a> to provide model diagnostic checking. Indeed, this function provides the backbone for function <em>plot</em> with argument <em>type="diag"</em>. Function <em>kalsmo</em> implements the Kalman smoothing described in section <a href="#S:carsmo">0.2.5</a>.</p>
<p>You can install the development version of <em>cts</em> from GitHub with:</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># install.packages("devtools")</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span><span class="op">(</span><span class="st">"zhuwang46/cts"</span><span class="op">)</span></code></pre></div>
<p>All analyses presented below are contained in a package vignette. The rendered output of the analyses is available by the <em>R</em>-command</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st">"cts"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/vignette.html">vignette</a></span><span class="op">(</span><span class="st">"kf"</span>,package <span class="op">=</span> <span class="st">"cts"</span><span class="op">)</span></code></pre></div>
<p>To reproduce the analyses, one can invoke the <em>R</em> code</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/edit.html">edit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/vignette.html">vignette</a></span><span class="op">(</span><span class="st">"kf"</span>,package <span class="op">=</span> <span class="st">"cts"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="data-examples" class="section level2">
<h2 class="hasAnchor">
<a href="#data-examples" class="anchor"></a><span class="header-section-number">0.4</span> Data examples</h2>
<p>Two data examples in <span class="citation">Belcher, Hampton, and Tunnicliffe Wilson (<a href="#ref-Belc:Hamp:Tunn:1994">1994</a>)</span> are used to illustrate the capabilities of <em>cts</em>. A detailed description of the data can be found in the original paper. Since some analysis here reproduces the results in <span class="citation">Belcher, Hampton, and Tunnicliffe Wilson (<a href="#ref-Belc:Hamp:Tunn:1994">1994</a>)</span>, we also ignore a lengthy discussion for brevity. These analyses were done using <em>R</em> version 4.0.3.</p>
<div id="geophysical-application" class="section level3">
<h3 class="hasAnchor">
<a href="#geophysical-application" class="anchor"></a><span class="header-section-number">0.4.1</span> Geophysical application</h3>
<p><span class="citation">Belcher, Hampton, and Tunnicliffe Wilson (<a href="#ref-Belc:Hamp:Tunn:1994">1994</a>)</span> analyzed 164 measurements of relative abundance of an oxygen isotope in an ocean core. These are unequally spaced time points with an average of separation of 2000 years. Unequally spaced tick marks indicate the corresponding irregularly sampled times in Figure <a href="#fig:oxy1">1</a>.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st">"cts"</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Attaching package: 'cts'</code></pre>
<pre><code>## The following objects are masked from 'package:stats':
## 
##     spectrum, tsdiag</code></pre>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"V22174"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### plot the oxygen isotope time series</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">V22174</span>,type<span class="op">=</span><span class="st">"l"</span>,xlab<span class="op">=</span><span class="st">"Time in kiloyears"</span>, ylab<span class="op">=</span><span class="st">""</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/rug.html">rug</a></span><span class="op">(</span><span class="va">V22174</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span id="fig:oxy1"></span>
<img src="kf_files/figure-html/oxy1-1.png" alt="Xoygen isotope series" width="672"><p class="caption">
Figure 1: Xoygen isotope series
</p>
</div>
<p>We first fit a model of order 14 to the data, following <span class="citation">Belcher, Hampton, and Tunnicliffe Wilson (<a href="#ref-Belc:Hamp:Tunn:1994">1994</a>)</span>. The scale parameter is chosen to be 0.2 as well. The estimation algorithm converges rather quickly as demonstrated in the following printout, which shows the sum of squares and the value of <span class="math inline">\(\phi_{14}\)</span> at each iteration. The results are similar to Table 1 of <span class="citation">Belcher, Hampton, and Tunnicliffe Wilson (<a href="#ref-Belc:Hamp:Tunn:1994">1994</a>)</span>, which took 30 minutes on a PC386/387 machine to carry out the computing. These authors expected that simple improvements to the program's code could substantially speed up the procedure. Despite that the current <em>cts</em> package has no intent to accomplish such a task, running the above <em>car</em> function took only 0.5 second, on an ordinary desktop PC (Intel Core 2 CPU, 1.86 GHz). Such a dramatic efficiency improvement is unlikely driven by software change, but by hardware advancement in the last 20 years.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### fit the modified form of a continuous AR(14) model</span>
<span class="va">V22174.car14</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/car.html">car</a></span><span class="op">(</span><span class="va">V22174</span>,scale<span class="op">=</span><span class="fl">0.2</span>,order<span class="op">=</span><span class="fl">14</span><span class="op">)</span>
<span class="va">tab1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">V22174.car14</span><span class="op">$</span><span class="va">tnit</span>, <span class="va">V22174.car14</span><span class="op">$</span><span class="va">ss</span>, <span class="va">V22174.car14</span><span class="op">$</span><span class="va">bit</span><span class="op">[</span>,<span class="fl">14</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">tab1</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Iteration"</span>,<span class="st">"Sum of Squares"</span>,<span class="st">"phi_14"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">tab1</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span>,row.names<span class="op">=</span><span class="cn">FALSE</span>, print.gap<span class="op">=</span><span class="fl">8</span><span class="op">)</span></code></pre></div>
<pre><code>##         Iteration        Sum of Squares          phi_14
##                 0              12.92737         0.00000
##                 1               8.32272        -0.16453
##                 2               8.24798        -0.23762
##                 3               8.24156        -0.21668
##                 4               8.24013        -0.23189
##                 5               8.23935        -0.22256
##                 6               8.23899        -0.23043
##                 7               8.23877        -0.22493
##                 8               8.23866        -0.22931
##                 9               8.23859        -0.22613</code></pre>
<p>Following section <a href="#S:caraic">0.2.3</a>, a model selection was conducted with <em>AIC</em> which generates exactly the same results as Table 2 of <span class="citation">Belcher, Hampton, and Tunnicliffe Wilson (<a href="#ref-Belc:Hamp:Tunn:1994">1994</a>)</span>. Accordingly, the first-order value for the AIC shows the most rapid drop from the base-line of 0. Consequently a large <span class="math inline">\(t\)</span>-value of 3.20 suggests order 7 while the minimum AIC implies order 9. For illustration, a model order 7 was selected as in <span class="citation">Belcher, Hampton, and Tunnicliffe Wilson (<a href="#ref-Belc:Hamp:Tunn:1994">1994</a>)</span>.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### AIC output based on Belcher et. al (1994)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">V22174.car14</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Call:
## car(x = V22174, scale = 0.2, order = 14)
## 
## Model selection statistics 
## 
##  order t.statistic     AIC
##      1       -8.66  -72.93
##      2        1.72  -73.89
##      3       -1.35  -73.72
##      4        3.56  -84.41
##      5        3.61  -95.47
##      6        0.89  -94.27
##      7        3.20 -102.50
##      8        2.15 -105.14
##      9       -2.00 -107.16
##     10       -0.82 -105.83
##     11        0.71 -104.34
##     12        0.04 -102.34
##     13       -1.91 -103.99
##     14       -1.92 -105.66</code></pre>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### fit the modified form of a continuous AR(7) model</span>
<span class="va">V22174.car7</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/car.html">car</a></span><span class="op">(</span><span class="va">V22174</span>,scale<span class="op">=</span><span class="fl">0.2</span>,order<span class="op">=</span><span class="fl">7</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">V22174.car7</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Call:
## car(x = V22174, scale = 0.2, order = 7)
## 
## Order of model = 7, sigma^2 = 1.37e-09 
## 
## Estimated coefficients (standard errors):
##       phi_1 phi_2 phi_3  phi_4 phi_5  phi_6 phi_7
## coef -0.501 0.355 0.085 -0.022 0.605 -0.371 0.483
## S.E.  0.108 0.111 0.060  0.071 0.084  0.124 0.112
## 
## Estimated mean (standard error):
## [1] 0.173
## [1] 0.022</code></pre>
<p>Alternatively, the following code illustrates how to conduct model selection via the classical AIC or BIC by fitting the models of increasing order <span class="math inline">\(p\)</span> to the series. Indeed, the model with order <span class="math inline">\(p=7\)</span> is the second best model selected by the AIC and the best model by the BIC.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### classical AIC and BIC results for model selection</span>
<span class="va">norder</span> <span class="op">&lt;-</span> <span class="fl">14</span>
<span class="va">V22174.aic</span> <span class="op">&lt;-</span> <span class="va">V22174.bic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">norder</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">norder</span><span class="op">)</span><span class="op">{</span>
<span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/car.html">car</a></span><span class="op">(</span><span class="va">V22174</span>,scale<span class="op">=</span><span class="fl">0.2</span>,order<span class="op">=</span><span class="va">i</span><span class="op">)</span>
<span class="va">V22174.aic</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">fit</span><span class="op">$</span><span class="va">aic</span>
<span class="va">V22174.bic</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">fit</span><span class="op">$</span><span class="va">bic</span>
<span class="op">}</span>
<span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>order<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="va">norder</span>, AIC<span class="op">=</span><span class="va">V22174.aic</span>, BIC<span class="op">=</span><span class="va">V22174.bic</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">res</span>, row.names<span class="op">=</span><span class="cn">FALSE</span>, print.gap<span class="op">=</span><span class="fl">8</span><span class="op">)</span></code></pre></div>
<pre><code>##         order             AIC             BIC
##             1        395.8212        402.0210
##             2        395.4665        404.7661
##             3        397.1475        409.5470
##             4        395.2427        410.7420
##             5        380.2526        398.8518
##             6        381.2466        402.9457
##             7        371.6226        396.4216
##             8        373.5190        401.4178
##             9        374.2532        405.2519
##            10        375.2333        409.3318
##            11        376.8200        414.0184
##            12        378.8153        419.1136
##            13        362.1151        405.5132
##            14        375.8480        422.3460</code></pre>
<p>The estimated spectra for both models of order 14 and 7 are displayed on logarithmic (base 10) scale in Figure <a href="#fig:specox">2</a>. Both two models indicate three peaks, while for the model of order 14 the resolution is much improved. In spectrum calculation, the default frequency range is set as from zero to <em>scale</em> parameter <span class="math inline">\(\kappa\)</span> in <em>n.freq=500</em> intervals. It is convenient to plot the spectrum for a new range of frequencies with the argument <em>frmult</em> which can be used to multiply the frequency range.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### plot the spectrum for the modified continuous AR(14) and AR(7) models</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/car.html">spectrum</a></span><span class="op">(</span><span class="va">V22174.car14</span><span class="op">)</span>
<span class="fu"><a href="../reference/car.html">spectrum</a></span><span class="op">(</span><span class="va">V22174.car7</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span id="fig:specox"></span>
<img src="kf_files/figure-html/specox-1.png" alt="Spectra from fitted models for the oxygen isotope series." width="672"><p class="caption">
Figure 2: Spectra from fitted models for the oxygen isotope series.
</p>
</div>
<p>To check model assumptions as described in section <a href="#S:cardiag">0.2.4</a>, Figure <a href="#fig:diagox">3</a> displays a plot of the standardized residuals, the ACF of the residuals, cumulative periodogram of the standardized residuals, and the p-values associated with the Ljung-Box statistic. Visual inspection of the time plot of the standardized residuals in Figure 3 shows no obvious patterns, although one outlier extends 3 standard deviations. The ACF of the standardized residuals shows no apparent departure from the model assumptions, i.e., approximately independently and normally distributed with zero means and variances <span class="math inline">\(1/n\)</span> at lag &gt; 0. The cumulative periodogram of standardized residuals follows the line <span class="math inline">\(y=2x\)</span> reasonably well. The Ljung-Box statistic is not significant at the lags shown.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### model diagnostics check</span>
<span class="fu"><a href="../reference/car.html">tsdiag</a></span><span class="op">(</span><span class="va">V22174.car7</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span id="fig:diagox"></span>
<img src="kf_files/figure-html/diagox-1.png" alt="Model diagnostics for the oxygen isotope series." width="672"><p class="caption">
Figure 3: Model diagnostics for the oxygen isotope series.
</p>
</div>
</div>
<div id="medical-application" class="section level3">
<h3 class="hasAnchor">
<a href="#medical-application" class="anchor"></a><span class="header-section-number">0.4.2</span> Medical application</h3>
<p><span class="citation">Belcher, Hampton, and Tunnicliffe Wilson (<a href="#ref-Belc:Hamp:Tunn:1994">1994</a>)</span> analyzed 209 measurements of the lung function of an asthma patient. The time series is measured mostly at 2 hour time intervals but with irregular gaps, as demonstrated by the unequal space of tick marks in Figure <a href="#fig:asth1">4</a>.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"asth"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">asth</span>,type<span class="op">=</span><span class="st">"l"</span>,xlab<span class="op">=</span><span class="st">"Time in hours"</span>, ylab<span class="op">=</span><span class="st">""</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/rug.html">rug</a></span><span class="op">(</span><span class="va">asth</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span id="fig:asth1"></span>
<img src="kf_files/figure-html/asth1-1.png" alt="Measurements of the lung function." width="672"><p class="caption">
Figure 4: Measurements of the lung function.
</p>
</div>
<p>To apply <em>cts</em>, a scale parameter 0.25 was chosen and a model of order 4 was fitted to the data <span class="citation">(Belcher, Hampton, and Tunnicliffe Wilson <a href="#ref-Belc:Hamp:Tunn:1994">1994</a>)</span>.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### fit the modified form of a continuous AR(4) model</span>
<span class="va">asth.car4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/car.html">car</a></span><span class="op">(</span><span class="va">asth</span>,scale<span class="op">=</span><span class="fl">0.25</span>,order<span class="op">=</span><span class="fl">4</span>, ctrl<span class="op">=</span><span class="fu"><a href="../reference/car_control.html">car_control</a></span><span class="op">(</span>n.ahead<span class="op">=</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">asth.car4</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Call:
## car(x = asth, scale = 0.25, order = 4, ctrl = car_control(n.ahead = 10))
## 
## Order of model = 4, sigma^2 = 0.779 
## 
## Estimated coefficients (standard errors):
##      phi_1 phi_2 phi_3  phi_4
## coef 0.093 0.037 0.015 -0.701
## S.E. 0.075 0.071 0.077  0.096
## 
## Estimated mean (standard error):
## [1] 495.544
## [1] 4.524</code></pre>
<p>The log-spectrum (base 10) of the fitted model is shown in Figure 5. The spectral peak indicates a strong diurnal cycle in the data.</p>
<p>It is possible to fit a model with an observation error term by setting <em>vri=TRUE</em> in the parameter control statement. The following code shows how to fit such a model. The estimated observation error variance can be found with the <em>summary</em> command and the corresponding spectrum in Figure <a href="#fig:asth2">5</a> is compared with the model without an observation error.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### fit the modified form of a continuous AR(7) model with measurement error</span>
<span class="va">asth.vri</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/car.html">car</a></span><span class="op">(</span><span class="va">asth</span>,scale<span class="op">=</span><span class="fl">0.25</span>,order<span class="op">=</span><span class="fl">4</span>, ctrl<span class="op">=</span><span class="fu"><a href="../reference/car_control.html">car_control</a></span><span class="op">(</span>vri<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">asth.vri</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Call:
## car(x = asth, scale = 0.25, order = 4, ctrl = car_control(vri = TRUE))
## 
## Order of model = 4, sigma^2 = 0.000158 
## 
## Observation error variance: 243 
## 
## Estimated coefficients (standard errors):
##       phi_1 phi_2  phi_3 phi_4
## coef -1.489 1.556 -1.462 0.680
## S.E.  0.128 0.130  0.137 0.125
## 
## Estimated mean (standard error):
## [1] 494.249
## [1] 3.128</code></pre>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### plot of spectrum for the continuous AR(4) model without/with measurement error</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/car.html">spectrum</a></span><span class="op">(</span><span class="va">asth.car4</span><span class="op">)</span>
<span class="fu"><a href="../reference/car.html">spectrum</a></span><span class="op">(</span><span class="va">asth.vri</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span id="fig:asth2"></span>
<img src="kf_files/figure-html/asth2-1.png" alt="Spectra from fitted models without and with an observation error term (top and bottom panel, respectively), for the lung function measurements." width="672"><p class="caption">
Figure 5: Spectra from fitted models without and with an observation error term (top and bottom panel, respectively), for the lung function measurements.
</p>
</div>
<p>Nevertheless, we focus on the model fit <em>asth.car4</em> without the measurement error. Applying function <em>factab</em> to this model returns one complex zero and two real zeros.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### determine the zeros of equation (3)</span>
<span class="fu"><a href="../reference/factab.html">factab</a></span><span class="op">(</span><span class="va">asth.car4</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Call:
## factab(object = asth.car4)
## 
## Characteristic root of original parameterization in alpha 
## 
##             1              2              3              4  
## -0.016+0.000i  -0.020+0.255i  -0.020-0.255i  -7.246+0.000i
## 
## Frequency 
## 
##     1      2      3      4  
## 0.000  0.041  0.041  0.000</code></pre>
<p>We thus decomposed the original time series into three corresponding components via the Kalman smoother as shown in Figure <a href="#fig:asth3">6</a>.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### decompose the original time series into three corresponding components </span>
<span class="co">### via the Kalman smoother </span>
<span class="va">asth.kalsmo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/car.html">kalsmo</a></span><span class="op">(</span><span class="va">asth.car4</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/kalsmoComp.html">kalsmoComp</a></span><span class="op">(</span><span class="va">asth.kalsmo</span>,comp<span class="op">=</span><span class="fl">1</span>, xlab<span class="op">=</span><span class="st">"Time in hours"</span><span class="op">)</span>
<span class="fu"><a href="../reference/kalsmoComp.html">kalsmoComp</a></span><span class="op">(</span><span class="va">asth.kalsmo</span>,comp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>, xlab<span class="op">=</span><span class="st">"Time in hours"</span><span class="op">)</span>
<span class="fu"><a href="../reference/kalsmoComp.html">kalsmoComp</a></span><span class="op">(</span><span class="va">asth.kalsmo</span>,comp<span class="op">=</span><span class="fl">4</span>,xlab<span class="op">=</span><span class="st">"Time in hours"</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span id="fig:asth3"></span>
<img src="kf_files/figure-html/asth3-1.png" alt="Components of the lung function measurements. From top to bottom: trend component, diurnal component, and approximate white noise component." width="672"><p class="caption">
Figure 6: Components of the lung function measurements. From top to bottom: trend component, diurnal component, and approximate white noise component.
</p>
</div>
<p>Finally, we predicted the last 10 steps past the end of time series in Figure <a href="#fig:asth7">7</a>.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### predict the last 10 steps past the end of time series</span>
<span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">asth.car4</span>, xlab<span class="op">=</span><span class="st">"Time in hours"</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Call:
## car(x = asth, scale = 0.25, order = 4, ctrl = car_control(n.ahead = 10))
## 
##               1       2       3       4       5       6       7       8       9
## Time    671.000 672.000 673.000 674.000 675.000 676.000 677.000 678.000 679.000
## Predict 527.692 522.959 516.956 510.116 502.904 495.786 489.208 483.561 479.165
##              10
## Time    680.000
## Predict 476.245</code></pre>
<div class="figure">
<span id="fig:asth7"></span>
<img src="kf_files/figure-html/asth7-1.png" alt="Forecasts (circles) for lung function measurements." width="672"><p class="caption">
Figure 7: Forecasts (circles) for lung function measurements.
</p>
</div>
</div>
</div>
<div id="conclusion" class="section level2">
<h2 class="hasAnchor">
<a href="#conclusion" class="anchor"></a><span class="header-section-number">0.5</span> Conclusion</h2>
<p>In this article we have outlined the methods and algorithms for fitting continuous time autoregressive models through the Kalman filter. The theoretical ingredients of Kalman filter have their counterparts in the <em>R</em> package <em>cts</em>, which can be particularly useful with unequally sampled time series data.</p>
</div>
<div id="acknowledgment" class="section level2">
<h2 class="hasAnchor">
<a href="#acknowledgment" class="anchor"></a><span class="header-section-number">0.6</span> Acknowledgment</h2>
<p>The author thanks Granville Tunnicliffe Wilson for invaluable assistance. The author also thanks the Editors and reviewers for their constructive remarks and suggestions, which have greatly improved the article and software.</p>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references">
<div id="ref-Rcite">
<p> Development Core Team. 2020. <em>R: A Language and Environment for Statistical Computing</em>. Vienna, Austria: R Foundation for Statistical Computing. <a href="http://www.R-project.org" class="uri">http://www.R-project.org</a>.</p>
</div>
<div id="ref-Akaike1974">
<p>Akaike, H. 1974. “A New Look at the Statistical Model Identification.” <em>IEEE Transactions on Automatic Control</em> 19 (6): 716–23.</p>
</div>
<div id="ref-Belc:Hamp:Tunn:1994">
<p>Belcher, J., J. S. Hampton, and G. Tunnicliffe Wilson. 1994. “Parameterization of Continuous Time Autoregressive Models for Irregularly Sampled Time Series Data.” <em>Journal of the Royal Statistical Society B</em> 56: 141–55.</p>
</div>
<div id="ref-Berg:1990">
<p>Bergstrom, A. R. 1990. <em>Continuous Time Econometric Modeling</em>. New York: Oxford University Press.</p>
</div>
<div id="ref-Doob:1953">
<p>Doob, J. L. 1953. <em>Stochastic Processes</em>. New York: John Wiley &amp; Sons.</p>
</div>
<div id="ref-Durb:Koop:2001">
<p>Durbin, James, and S. J. Koopman. 2001. <em>Time Series Analysis by State Space Methods</em>. Oxford: Oxford University Press.</p>
</div>
<div id="ref-Harv:1990">
<p>Harvey, A. C. 1990. <em>Forecasting, Structural Time Series Models and the Kalman Filter</em>. Cambridge: Cambridge University Press.</p>
</div>
<div id="ref-Jenk:Watt:1968">
<p>Jenkins, Gwilym M., and Donald G. Watts. 1968. <em>Spectral Analysis and Its Applications</em>. San Francisco, California: Holden-Day.</p>
</div>
<div id="ref-Jone:1981">
<p>Jones, Richard H. 1981. “Fitting a Continuous Time Autoregression to Discrete Data.” In <em>Applied Time Series Analysis Ii</em>, 651–82.</p>
</div>
<div id="ref-Mole:Loan:2003">
<p>Moler, Cleve, and Charles Van Loan. 2003. “Nineteen Dubious Ways to Compute the Exponential of a Matrix, Twenty-Five Years Later.” <em>SIAM Review</em> 45 (1): 3–49.</p>
</div>
<div id="ref-bic">
<p>Schwarz, Gideon. 1978. “Estimating the Dimension of a Model.” <em>Annals of Statistics</em> 6 (2): 461–64.</p>
</div>
<div id="ref-Tunn:2004">
<p>Tunnicliffe Wilson, G., and A. S. Morton. 2004. “Modelling Multiple Time Series: Achieving the Aims.” In <em>Proceedings in Computational Statistics, 2004</em>, edited by Jaromir Antoch, 527–38. Physica Verlag, Heidelberg.</p>
</div>
<div id="ref-cts">
<p>Tunnicliffe Wilson, G., and Zhu Wang. 2013. <em>Cts: Continuous Time Autoregressive Models</em>.</p>
</div>
<div id="ref-Wang:2004">
<p>Wang, Zhu. 2004. “The Application of the Kalman Filter to Nonstationary Time Series Through Time Deformation.” PhD thesis, Southern Methodist University.</p>
</div>
<div id="ref-Wang:Wood:Gray:2008">
<p>Wang, Zhu, Wayne A. Woodward, and Henry L. Gray. 2009. “The Application of the Kalman Filter to Nonstationary Time Series Through Time Deformation.” <em>Journal of Time Series Analysis</em> 30 (5): 559–74.</p>
</div>
<div id="ref-Whit:2004">
<p>Whitelock, P. A., M. W. Feast, F. Marang, and E. Breedt. 2004. “The 2003 Shell Event in <span class="math inline">\(\eta\)</span> Carinae.” <em>Monthly Notices of the Royal Astronomical Society</em> 352 (2): 447–56.</p>
</div>
<div id="ref-Wibe:1971">
<p>Wiberg, D. M. 1971. <em>Schaum’s Outline of Theory and Problems of State Space and Linear Systems</em>. New York: McGRAW-HILL.</p>
</div>
</div>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>UT Health San Antonio, <a href="mailto:wangz1@uthscsa.edu">wangz1@uthscsa.edu</a><a href="#fnref1">↩</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Zhu Wang.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
